.oda:
  extends:
    - .on_demand_rules
    - .mid
  stage: verify-test-equipment
  tags:
    - ska-k8srunner-za-itf
  image: $TEST_IMAGE
  variables:
    K8S_CHART: ska-db-oda
    KUBE_APP: ska-db-oda
    INGRESS_HOST: "k8s.miditf.internal.skao.int"
    CLUSTER_DOMAIN: "miditf.internal.skao.int"
    K8S_EXTRA_PARAMS: "--set global.ska-tango-archiver.enabled=false  --set ska-tango-archiver.enabled=false"
    TANGO_DATABASE_DS: tango-databaseds
    KUBE_NAMESPACE: ci-ska-mid-itf-oda-$CI_COMMIT_REF_NAME
    MINIKUBE: "false"
  environment:
    name: sut/oda/$KUBE_NAMESPACE
    kubernetes:
      namespace: $KUBE_NAMESPACE
    url: "http://$INGRESS_HOST/$KUBE_NAMESPACE/taranta"
  when: manual


deploy-oda:
  extends:
    - .oda
  script:
    - make k8s-install-chart
  after_script:
    - make k8s-template-chart

destroy-oda:
  extends:
    - .oda
  script:
    - - !reference [.cleanup, script]
  environment:
    action: stop
