- name: Ensure docker is running
  become: true
  ansible.builtin.service:
    name: docker
    state: started

- name: Pull blackbox image
  become: true
  community.docker.docker_image:
    name: "{{ blackbox_image }}"
    source: pull
    pull:
      platform: amd64

- name: Start blackbox
  become: true
  community.docker.docker_container:
    recreate: true
    debug: true
    name: blackbox
    image: "{{ blackbox_image }}"
    ports:
      - "{{ blackbox_port }}:{{ blackbox_port }}"
    volumes:
      - /opt/blackbox/blackbox.yaml:/blackbox.yml
